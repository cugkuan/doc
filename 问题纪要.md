
# 图片上传

> java.net.ProtocolException: expected 4830 bytes but received 8192

在上传图片的时候，偶发性的报错，而且，这个问题只存在部分手机中。
 
 **原因**

图片上传的时候，给的size 大小 和实际上传的大小不一致，导致服务器关闭了流的传输。


造成这种情况，很多，可能是多个线程对文件进行读写，文件还没有写完，就开始上传了。

**解决方式**

能找到问题的原因更好，如果早不到问题的原因。最好的方式copy一份要上传的问题。上传copy的文件。


# content-length = -1 导致下载的逻辑问题


# koltin if else if 导致的问题


koltin的if else 是一个表达式，但是下面的代码会出现问题:

```java
  if (true){
        "1"
    }else if (false){
        "2"
    }else{
        "3"
    }.let {
        println(it)
    }
```

你会发现，没有任何输出


如果是下面这种写法

```
  if (true){
        "1"
    } else{
        "3"
    }.let {
        println(it)
    }
```
那么又是正常的


为什么会这样？猜测是 koltin 的bug ,这个bug 匪夷所思

# kolint 的 interface clone 接口问题



# 腾讯 x5 浏览，不支持浏览在线文档引发的问题。


当网页中，的某个链接地址是 pdf或者其它类型的文件时，由于腾讯x5 引擎处理不了于是 DownloadListener 会被回调，告诉你引擎处理不了，但是 问题代码就出现：

```java

   webView?.setDownloadListener { url: String?, userAgent: String?, contentDisposition: String?, mimetype: String?, contentLength: Long ->
            val intent = Intent()
            intent.action = "android.intent.action.VIEW"
            val contentUrl = Uri.parse(url)
            intent.data = contentUrl
            startActivity(intent)
        }

```

这样，造成了一个死循环了。


解决方式是，对于不能处理的文件直接走文件预览的流程。

# 部分 OPPO 和一加手机无法启动摄像头

代码如下：

```
 public void startOpenCameraVideo() {
        Intent cameraIntent = new Intent(MediaStore.ACTION_VIDEO_CAPTURE);
        if (cameraIntent.resolveActivity(getPackageManager()) != null) {
            File cameraFile = PictureFileUtils.createCameraFile(this, config.mimeType ==
                            PictureConfig.TYPE_ALL ? PictureConfig.TYPE_VIDEO : config.mimeType,
                    outputCameraPath, config.suffixType);
            cameraPath = cameraFile.getAbsolutePath();
            Uri imageUri = parUri(cameraFile);
            cameraIntent.putExtra(MediaStore.EXTRA_OUTPUT, imageUri);
            cameraIntent.putExtra(MediaStore.EXTRA_DURATION_LIMIT, config.recordVideoSecond);
            cameraIntent.putExtra(MediaStore.EXTRA_VIDEO_QUALITY, config.videoQuality);
            startActivityForResult(cameraIntent, PictureConfig.REQUEST_CAMERA);
        }
    }
```

上面的代码也是Android官方的写法，在大部分的手机上都没啥问题，但是偏偏部分的 OPPO 手机无法唤起


## 解决方法
 
  在manifest.xml中添加如下的配置
```html
   <queries>
        <intent>
            <action android:name="android.media.action.IMAGE_CAPTURE" />
        </intent>
    </queries>
```
https://developer.android.com/about/versions/11/privacy/package-visibility#all-apps

但是问题在于，摄像头一直作为系统应用的，应该满足其协议应用，但是，OPPO的新系统，确把拍照，摄像机做为一个应用级别的app了，需要配置软件包的可见性。真尼玛的坑
